#---------------------------------------------------------------------------------#
# Bla bli bla bla 
#---------------------------------------------------------------------------------#
VPATH := ../src
CFLAGS += -I . -I $(VPATH) 
LFLAGS += -DDEBUG
OBJ := $(subst .c,.o,$(notdir $(wildcard $(VPATH)/*.c)))

#---------------------------------------------------------------------------------#
# Pattern rules
#---------------------------------------------------------------------------------#
%.c: %.l
	$(LEX) $(LFLAGS) -t $< > $@

%.c: %.y
	$(YACC) -d $< -o $@ 

#---------------------------------------------------------------------------------#
# Build targets
#---------------------------------------------------------------------------------#
parser: $(OBJ) parser.o lexer.o
	@echo ----- 
	@echo $(OBJ)
	@echo ----- 
	$(CC) $^ -o $@ 

parser.c: parser.y

lexer.c: lexer.l parser.c

#---------------------------------------------------------------------------------#
# Misc
#---------------------------------------------------------------------------------#
.PHONY: test
test: parser
	sh ../test/run.sh $(PWD)/parser ../test

.PHONY: clean
clean: 
	$(RM) *.c *.h *.o parser lexer 

