#---------------------------------------------------------------------------------#
# Bla bli bla bla 
#---------------------------------------------------------------------------------#
VPATH := ../src
CFLAGS += -std=c99 -I . -I $(VPATH) -D_BSD_SOURCE -D_POSIX_SOURCE
LFLAGS += -DNDEBUG
OBJ := $(subst .c,.o,$(notdir $(wildcard $(VPATH)/*.c)))

#---------------------------------------------------------------------------------#
# Pattern rules
#---------------------------------------------------------------------------------#
%.c: %.l
	$(LEX) $(LFLAGS) -t $< > $@

%.c: %.y
	$(YACC) -d $< -o $@

#---------------------------------------------------------------------------------#
# Build targets
#---------------------------------------------------------------------------------#
installer: $(OBJ) parser.o lexer.o
	$(CC) $^ -o $@ 

parser.c: parser.y lexer.h

lexer.c: lexer.l parser.c

#---------------------------------------------------------------------------------#
# Misc
#---------------------------------------------------------------------------------#
.PHONY: test
test: installer
	@sh ../test/run.sh $(PWD)/installer ../test

.PHONY: clean
clean: 
	$(RM) *.c *.h *.o installer lexer installer.tmp.* leak.*

